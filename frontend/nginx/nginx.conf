
server {
  listen 3000;

  # Redirect incorrectly nested static file requests back to root
  location ~ ^/.+/static/(.+)$ {
    return 301 /static/$1;
  }

  # Handle static files from root
  location /static/ {
    root /usr/share/nginx/html;
    expires 1y;
    add_header Cache-Control "public, immutable";
    try_files $uri =404;
  }

  # Handle root files (manifest, favicon, etc.)
  location ~* \.(json|ico|png|jpg|jpeg|gif|svg|woff|woff2|ttf|eot)$ {
    root /usr/share/nginx/html;
    expires 1y;
    add_header Cache-Control "public";
    try_files $uri =404;
  }

  # Catch-all: serve index.html for all other requests (React Router)
  location / {
    root /usr/share/nginx/html;
    try_files $uri /index.html;
  }
}